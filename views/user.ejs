<% include ./partials/head-light.ejs %>
<% include ./partials/header.ejs %>

<body class="with-menu">

  <section class="menu" ng-controller="MenuController" ng-init="init(<%= JSON.stringify(user) %>, <%= JSON.stringify(lists) %>)">
    <div class="owner">
      <%= owner.givenName + "'s Pelican" %>
    </div>
    <div class="body">
      <div class="relative">
        <input type="text" ng-model="query" placeholder="Search..." escape-search/>
        <div class="icon ion-android-close" ng-click="query = ''" ng-show="query"></div>
      </div>
      <div class="list menu-list"
           ng-click="makeActive(list)"
           id="menu-list-{{list._id}}"
           ng-repeat="list in lists | menuSearch:query"
           menu-helper ng-cloak>
        <p ng-bind-html="sanitizeHtml(list.title)"></p>
        <div class="posts" ng-show="query || list.displayPosts">
          <hr />
          <div class="post" ng-repeat="post in list.posts">
            <p ng-bind-html="sanitizeHtml(post.title)"></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="lists user" ng-controller="ListsController" ng-init="init(<%= JSON.stringify(user) %>, <%= JSON.stringify(lists) %>)" ng-cloak>

    <div class="list" id="list-{{list._id}}"
         ng-repeat="list in lists"
         ng-class="{ 'private-list': list.isPrivate }">
      <h2>
        {{list.title}}
        <span class="icon"
              ng-class="list.isPrivate ? 'ion-ios-locked' : 'ion-ios-unlocked-outline'"
              ng-if="user && user._id"
              ng-click="toggleListLock(list)"></span>
      </h2>

      <section class="post" ng-click="openPost(post, $index, $parent.$index)" ng-repeat="post in list.posts">
        <div class="body">
          <p class="post-title">{{post.title}}</p>
          <a ng-href="{{post.link}}" target="blank">{{post.link}}</a>
          <p class="text" ng-if="post.text">{{post.text}}</p>
        </div>
        <div class="author"></div>
      </section>

    </div>

    <% include ./partials/post-modal.ejs %>

    <button class="compose" ng-click="openComposeModal()" ng-if="user && user._id"><span class="icon ion-android-add"></span></button>
    <% include ./partials/list-modal.ejs %>
  </section>

<% include ./partials/footer.ejs %>
